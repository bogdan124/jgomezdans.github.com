<!DOCTYPE html>
<html lang="en">
<head>
        <meta charset="utf-8" />
        <title>Creating a country raster mask using GDAL</title>
        <link rel="stylesheet" href="/theme/css/main.css" />
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="EO & DA ramblings Atom Feed" />

        <!--[if IE]>
            <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script>
        <![endif]-->
</head>

<body id="index" class="home">
<a href="http://github.com/jgomezdans">
<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />
</a>
        <header id="banner" class="body">
                <h1><a href="/">EO & DA ramblings </a></h1>
                <nav><ul>
                    <li class="active"><a href="/category/blog.html">Blog</a></li>
                </ul></nav>
        </header><!-- /#banner -->
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="/creating-a-country-raster-mask-using-gdal.html" rel="bookmark"
           title="Permalink to Creating a country raster mask using GDAL">Creating a country raster mask using GDAL</a></h1>
    </header>

    <div class="entry-content">
<footer class="post-info">
        <abbr class="published" title="2012-08-02T10:00:00">
                Thu 02 August 2012
        </abbr>

        <address class="vcard author">
                By <a class="url fn" href="/author/j-gomez-dans.html">J GÃ³mez-Dans</a>
        </address>
<p>In <a href="/category/blog.html">Blog</a>. </p>
<p>tags: <a href="/tag/gdal.html">GDAL</a><a href="/tag/remote-sensing.html">remote sensing</a><a href="/tag/tips.html">tips</a></p>
</footer><!-- /.post-info -->      <p>Usually, we remote sensing types ignore country boundaries: they don't really
make much sense, as they are not aligned with MODIS pixels ;-) However, I was
asked what's the easiest way to produce a global mask of countries, so that all
th grid cells (say at 0.5 degree resolution) that fall within a country are
given the same number. I guess the easiest thing would be to use QGIS, add a
new layer with the offending name (<tt class="docutils literal">$id</tt> is the field you are looking for
there!), and then rasterise the layer.</p>
<p>But how do to you that with <a class="reference external" href="http://gdal.osegeo.org/">GDAL</a>? We can use
<tt class="docutils literal">gdal_rasterize</tt> for this, and I assume that you are using 1.8.0 or later.
Let's say we use the ubiquitous
<a class="reference external" href="http://aprsworld.net/gisdata/world/">world shapefile</a>. We need to create a
single integer tag for each feature or country. The best of doing this is to
use GDAL's virtual variable <tt class="docutils literal">FID</tt>. However, you need to create the field on
the fly, as it were: you use the <tt class="docutils literal"><span class="pre">-sql</span></tt> statement, and add the <tt class="docutils literal">FID</tt>
variable that way (see
<a class="reference external" href="http://lists.osgeo.org/pipermail/gdal-dev/2010-February/023485.html">this</a>.
We also need to specify the extent of the raster output file. We'll oversample
a bit to start with</p>
<pre class="literal-block">
gdal_rasterize -of GTiff  -a FID  -sql &quot;select FID, * from world&quot;  \
  -te -180 -90 180 90 -tr 0.05 0.05 -a_srs &quot;EPSG:4326&quot; -a_nodata 0 \
  -ot UInt16 world.shp world_grid.tif
</pre>
<p>So, that gives us <tt class="docutils literal">world_grid.tif</tt></p>
<pre class="literal-block">
$ gdalinfo world_grid.tif -stats
Driver: GTiff/GeoTIFF
Files: world_grid.tif
Size is 7200, 3600
Coordinate System is:
GEOGCS[&quot;WGS 84&quot;,
    DATUM[&quot;WGS_1984&quot;,
        SPHEROID[&quot;WGS 84&quot;,6378137,298.257223563,
            AUTHORITY[&quot;EPSG&quot;,&quot;7030&quot;]],
        AUTHORITY[&quot;EPSG&quot;,&quot;6326&quot;]],
    PRIMEM[&quot;Greenwich&quot;,0],
    UNIT[&quot;degree&quot;,0.0174532925199433],
    AUTHORITY[&quot;EPSG&quot;,&quot;4326&quot;]]
Origin = (-180.000000000000000,90.000000000000000)
Pixel Size = (0.050000000000000,-0.050000000000000)
Metadata:
  AREA_OR_POINT=Area
Image Structure Metadata:
  INTERLEAVE=BAND
Corner Coordinates:
Upper Left  (-180.0000000,  90.0000000) (180d 0' 0.00&quot;W, 90d 0' 0.00&quot;N)
Lower Left  (-180.0000000, -90.0000000) (180d 0' 0.00&quot;W, 90d 0' 0.00&quot;S)
Upper Right ( 180.0000000,  90.0000000) (180d 0' 0.00&quot;E, 90d 0' 0.00&quot;N)
Lower Right ( 180.0000000, -90.0000000) (180d 0' 0.00&quot;E, 90d 0' 0.00&quot;S)
Center      (   0.0000000,   0.0000000) (  0d 0' 0.01&quot;E,  0d 0' 0.01&quot;N)
Band 1 Block=7200x1 Type=UInt16, ColorInterp=Gray
  Minimum=1.000, Maximum=243.000, Mean=166.683, StdDev=76.175
  NoData Value=0
  Metadata:
    STATISTICS_MINIMUM=1
    STATISTICS_MAXIMUM=243
    STATISTICS_MEAN=166.68288288267
    STATISTICS_STDDEV=76.17549545167
</pre>
<p>Cool, so how do we create a say 0.5degree grid from our 0.05degree grid?
<tt class="docutils literal">gdaladdo</tt> can help building overlays with a spatial resolution given as
integer multiples of 0.05 degrees. Within that new resolution, we can take the
mode of the 0.05 degree grid, and use that to label the new lower resolution
grid. Further assume that we want a 0.5 degree and a 1 degree grid out</p>
<pre class="literal-block">
gdaladdo -r mode world_grid.tif 10 20
gdal_translate -of GTiff -outsize 720 360 world_grid.tif world_grid_hd.tif
gdal_translate -of GTiff -outsize 368 180 world_grid.tif world_grid_1d.tif
</pre>
<p>And here you have a picture of how it looks. I'm using a random colormap with
matplotlib (see <a class="reference external" href="https://gist.github.com/402500">here</a>)</p>
<div class="figure">
<img alt="" src="images/world_map.png" style="width: 90%;" />
<p class="caption">The map, in all its glory.</p>
</div>
<script type= "text/javascript">
    if (!document.getElementById('mathjaxscript_pelican_#%@#$@#')) {
        var mathjaxscript = document.createElement('script');
        mathjaxscript.id = 'mathjaxscript_pelican_#%@#$@#';
        mathjaxscript.type = 'text/javascript';
        mathjaxscript.src = 'https:' == document.location.protocol
                ? 'https://c328740.ssl.cf1.rackcdn.com/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML'
                : 'http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML';
        mathjaxscript[(window.opera ? "innerHTML" : "text")] =
            "MathJax.Hub.Config({" +
            "    config: ['MMLorHTML.js']," +
            "    TeX: { extensions: ['AMSmath.js','AMSsymbols.js','noErrors.js','noUndefined.js'], equationNumbers: { autoNumber: 'AMS' } }," +
            "    jax: ['input/TeX','input/MathML','output/HTML-CSS']," +
            "    extensions: ['tex2jax.js','mml2jax.js','MathMenu.js','MathZoom.js']," +
            "    displayAlign: 'center'," +
            "    displayIndent: '0em'," +
            "    showMathMenu: true," +
            "    tex2jax: { " +
            "        inlineMath: [ ['$','$'] ], " +
            "        displayMath: [ ['$$','$$'] ]," +
            "        processEscapes: true," +
            "        preview: 'TeX'," +
            "    }, " +
            "    'HTML-CSS': { " +
            "        styles: { '.MathJax_Display, .MathJax .mo, .MathJax .mi, .MathJax .mn': {color: 'black ! important'} }" +
            "    } " +
            "}); ";
        (document.body || document.getElementsByTagName('head')[0]).appendChild(mathjaxscript);
    }
</script>

    </div><!-- /.entry-content -->

  </article>
</section>
        <section id="extras" class="body">
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate">atom feed</a></li>

                            <li><a href="http://twitter.com/pepucho666">twitter</a></li>
                            <li><a href="http://github.com/jgomezdans">github</a></li>
                        </ul>
                </div><!-- /.social -->
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->

    <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-25702318-1']);
    _gaq.push(['_trackPageview']);
    (function() {
        var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
        ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
        var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
    </script>
</body>
</html>