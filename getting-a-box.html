<!DOCTYPE html>
<html lang="en">
<head>
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
        <title>Getting a box</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href="./theme/css/main.css" type="text/css" />
        
        <link href="/feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="EO & DA ramblings Atom Feed" />
        
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie.css"/>
                <script src="./js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href="./css/ie6.css"/><![endif]-->
<!-- Using MathJax, with the delimiters $ -->
<!-- Conflict with pygments for the .mo and .mi -->
<script type="text/x-mathjax-config">
  MathJax.Hub.Config({
  "HTML-CSS": {
  styles: {
  ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
  },
  tex2jax: {inlineMath: [['$','$'], ['\\(','\\)']],processEscapes: true}
  });
  MathJax.Hub.Register.StartupHook("HTML-CSS Jax Ready",function () {
  var VARIANT = MathJax.OutputJax["HTML-CSS"].FONTDATA.VARIANT;
  VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
  VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
  VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
  VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
  });
  MathJax.Hub.Register.StartupHook("SVG Jax Ready",function () {
  var VARIANT = MathJax.OutputJax.SVG.FONTDATA.VARIANT;
  VARIANT["normal"].fonts.unshift("MathJax_SansSerif");
  VARIANT["bold"].fonts.unshift("MathJax_SansSerif-bold");
  VARIANT["italic"].fonts.unshift("MathJax_SansSerif-italic");
  VARIANT["-tex-mathit"].fonts.unshift("MathJax_SansSerif-italic");
  });
</script>

<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
</head>

<body id="index" class="home">

<a href="http://github.com/jgomezdans">

<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />

</a>

        <header id="banner" class="body">
                <h1><a href=".">EO & DA ramblings </a></h1>
                <nav><ul>
                
                
                
                
                
                    <li class="active"><a href="./category/blog.html">Blog</a></li>
                
                </ul></nav>
        </header><!-- /#banner -->
        
<section id="content" class="body">
  <article>
    <header>
      <h1 class="entry-title">
        <a href="getting-a-box.html" rel="bookmark"
           title="Permalink to Getting a box">Getting a box</a></h1>
      
    </header>

    <div class="entry-content">
      <footer class="post-info">
        <abbr class="published" title="2013-06-23T17:00:00">
                Sun 23 June 2013
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href="./author/j-gomez-dans.html">J Gómez-Dans</a>
        </address>
        
<p>In <a href="./category/blog.html">Blog</a>. </p>
<p>tags: <a href="./tag/gdal.html">GDAL</a><a href="./tag/tips.html">tips</a></p>


</footer><!-- /.post-info -->
      <p>Let's say one wants to find out a box around a given latitude/longitude point. How to do this
without GIS software using an artisan UNIX approach? Hell, if it works for coffee! The steps
are as follows:</p>
<ol class="arabic simple">
<li>Convert the centre point into UTM so we have meters rather than degrees</li>
<li>Write a box (manual buffering)</li>
<li>Convert the box corners back to WGS84</li>
</ol>
<p>We need to know the projection we want to use as degrees are not constant at all latitudes. To know what UTM zone you need you could go <a class="reference external" href="http://www.dmap.co.uk/utmworld.htm">here</a></p>
<img alt="From dmap.co.uk" class="align-center" src="http://www.dmap.co.uk/utmworld.gif" style="width: 500px;" />
<p>For the example above of Lopé National Park, we could use UTM zone 32S with the WGS84 datum. This, <a class="reference external" href="http://spatialreference.org/ref/epsg/32732/">according to spatialreference.org</a> is EPSG code 32732. Let' now use
<a class="reference external" href="http://www.gdal.org/gdaltransform.html">gdaltransform</a> to reproject to UTM:</p>
<div class="highlight"><pre><span class="nv">$ </span><span class="nb">echo </span>11.459789 -0.169737 | gdaltransform -s_srs <span class="s2">&quot;EPSG:4326&quot;</span> -t_srs <span class="s2">&quot;EPSG:32732&quot;</span>
773796.421559477 9981221.54175601 0
</pre></div>
<p>So this gives us the coordinates of the centre poin in meters. We know that we need a 10km square box around it, so we do this by defining the edges as (x-5000, y-5000), (x-5000, y+5000), (x+5000, y+5000), (x-5000, y+5000), (x-5000, y-5000). We can quickly just create a GML file with these points using a template like this:</p>
<div class="highlight"><pre><span class="cp">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="nt">&lt;ogr:FeatureCollection</span>
     <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
     <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://ogr.maptools.org/ gabon2.xsd&quot;</span>
     <span class="na">xmlns:ogr=</span><span class="s">&quot;http://ogr.maptools.org/&quot;</span>
     <span class="na">xmlns:gml=</span><span class="s">&quot;http://www.opengis.net/gml&quot;</span><span class="nt">&gt;</span>

  <span class="nt">&lt;gml:featureMember&gt;</span>
    <span class="nt">&lt;ogr:Site</span> <span class="na">fid=</span><span class="s">&quot;Site&quot;</span><span class="nt">&gt;</span>
      <span class="nt">&lt;ogr:geometryProperty&gt;&lt;gml:Polygon</span> <span class="na">srsName=</span><span class="s">&quot;EPSG:32732&quot;</span><span class="nt">&gt;&lt;gml:outerBoundaryIs&gt;&lt;gml:LinearRing&gt;&lt;gml:coordinates&gt;</span>%g,%g,0 %g,%g,0 %g,%g,0 %g,%g,0 %g,%g,0<span class="nt">&lt;/gml:coordinates&gt;&lt;/gml:LinearRing&gt;&lt;/gml:outerBoundaryIs&gt;&lt;/gml:Polygon&gt;&lt;/ogr:geometryProperty&gt;</span>
      <span class="nt">&lt;ogr:Name&gt;</span>Shape 1<span class="nt">&lt;/ogr:Name&gt;</span>
      <span class="nt">&lt;ogr:Description&gt;&lt;/ogr:Description&gt;</span>
    <span class="nt">&lt;/ogr:Site&gt;</span>
  <span class="nt">&lt;/gml:featureMember&gt;</span>
<span class="nt">&lt;/ogr:FeatureCollection&gt;</span>
</pre></div>
<p>In Python, we can just use the above snippet to populate the box, save it to a text file and convert it to our desired output:</p>
<div class="highlight"><pre><span class="n">gml</span> <span class="o">=</span> <span class="s">&quot;&quot;&quot;&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot; ?&gt;</span>
<span class="s">    &lt;ogr:FeatureCollection</span>
<span class="s">         xmlns:xsi=&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
<span class="s">         xsi:schemaLocation=&quot;http://ogr.maptools.org/ gabon2.xsd&quot;</span>
<span class="s">         xmlns:ogr=&quot;http://ogr.maptools.org/&quot;</span>
<span class="s">         xmlns:gml=&quot;http://www.opengis.net/gml&quot;&gt;</span>

<span class="s">      &lt;gml:featureMember&gt;</span>
<span class="s">        &lt;ogr:Site fid=&quot;Site&quot;&gt;</span>
<span class="s">          &lt;ogr:geometryProperty&gt;&lt;gml:Polygon srsName=&quot;EPSG:32732&quot;&gt;&lt;gml:outerBoundaryIs&gt;&lt;gml:LinearRing&gt;&lt;gml:coordinates&gt;</span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,0 </span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,0 </span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,0 </span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,0 </span><span class="si">%g</span><span class="s">,</span><span class="si">%g</span><span class="s">,0&lt;/gml:coordinates&gt;&lt;/gml:LinearRing&gt;&lt;/gml:outerBoundaryIs&gt;&lt;/gml:Polygon&gt;&lt;/ogr:geometryProperty&gt;</span>
<span class="s">          &lt;ogr:Name&gt;Shape 1&lt;/ogr:Name&gt;</span>
<span class="s">          &lt;ogr:Description&gt;&lt;/ogr:Description&gt;</span>
<span class="s">        &lt;/ogr:Site&gt;</span>
<span class="s">      &lt;/gml:featureMember&gt;</span>
<span class="s">    &lt;/ogr:FeatureCollection&gt;&quot;&quot;&quot;</span>
<span class="c"># The center location from gdaltransform</span>
<span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="mf">773796.421559477</span><span class="p">,</span> <span class="mf">9981221.54175601</span>
<span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span> <span class="p">(</span><span class="s">&quot;my_box.gml&quot;</span><span class="p">,</span> <span class="s">&#39;w&#39;</span> <span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">write</span> <span class="p">(</span> <span class="n">gml</span> <span class="o">%</span> <span class="p">(</span> <span class="n">x</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">5000</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">5000</span><span class="p">,</span> <span class="n">y</span><span class="o">+</span><span class="mi">5000</span><span class="p">,</span> <span class="n">x</span><span class="o">+</span><span class="mi">5000</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">x</span><span class="o">-</span><span class="mi">5000</span><span class="p">,</span> <span class="n">y</span><span class="o">-</span><span class="mi">5000</span><span class="p">)</span> <span class="p">)</span>
<span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
</pre></div>
<p>Now, <tt class="docutils literal">my_box.gml</tt> contains our box in UTM. What we want is a Shapefile in WGS84. We can use <tt class="docutils literal">ogr2ogr</tt> for that:</p>
<div class="highlight"><pre><span class="nv">$ </span>ogr2ogr -f <span class="s2">&quot;ESRI Shapefile&quot;</span> -t_srs <span class="s2">&quot;EPSG:4326&quot;</span> my_box_wgs84.shp my_box.gml
<span class="nv">$ </span>ogr2ogr -f <span class="s2">&quot;KML&quot;</span> -t_srs <span class="s2">&quot;EPSG:4326&quot;</span> my_box_wgs84.kml my_box.gml
</pre></div>
<p>Check that we got something useful:</p>
<div class="highlight"><pre><span class="nv">$ </span>ogrinfo -al -so my_box_wgs84.kml
Had to open data <span class="nb">source read</span>-only.
INFO: Open of <span class="sb">`</span>my_box_wgs84.kml<span class="s1">&#39;</span>
<span class="s1">      using driver `KML&#39;</span> successful.

Layer name: Site
Geometry: Polygon
Feature Count: 1
Extent: <span class="o">(</span>11.414887, -0.214953<span class="o">)</span> - <span class="o">(</span>11.504683, -0.124552<span class="o">)</span>
Layer SRS WKT:
GEOGCS<span class="o">[</span><span class="s2">&quot;WGS 84&quot;</span>,
    DATUM<span class="o">[</span><span class="s2">&quot;WGS_1984&quot;</span>,
        SPHEROID<span class="o">[</span><span class="s2">&quot;WGS 84&quot;</span>,6378137,298.257223563,
            AUTHORITY<span class="o">[</span><span class="s2">&quot;EPSG&quot;</span>,<span class="s2">&quot;7030&quot;</span><span class="o">]]</span>,
        TOWGS84<span class="o">[</span>0,0,0,0,0,0,0<span class="o">]</span>,
        AUTHORITY<span class="o">[</span><span class="s2">&quot;EPSG&quot;</span>,<span class="s2">&quot;6326&quot;</span><span class="o">]]</span>,
    PRIMEM<span class="o">[</span><span class="s2">&quot;Greenwich&quot;</span>,0,
        AUTHORITY<span class="o">[</span><span class="s2">&quot;EPSG&quot;</span>,<span class="s2">&quot;8901&quot;</span><span class="o">]]</span>,
    UNIT<span class="o">[</span><span class="s2">&quot;degree&quot;</span>,0.0174532925199433,
        AUTHORITY<span class="o">[</span><span class="s2">&quot;EPSG&quot;</span>,<span class="s2">&quot;9108&quot;</span><span class="o">]]</span>,
    AUTHORITY<span class="o">[</span><span class="s2">&quot;EPSG&quot;</span>,<span class="s2">&quot;4326&quot;</span><span class="o">]]</span>
Name: String <span class="o">(</span>0.0<span class="o">)</span>
Description: String <span class="o">(</span>0.0<span class="o">)</span>

<span class="nv">$ </span>ogrinfo -al -so my_box_wgs84.shp
INFO: Open of <span class="sb">`</span>my_box_wgs84.shp<span class="s1">&#39;</span>
<span class="s1">      using driver `ESRI Shapefile&#39;</span> successful.

Layer name: my_box_wgs84
Geometry: Polygon
Feature Count: 1
Extent: <span class="o">(</span>11.414887, -0.214953<span class="o">)</span> - <span class="o">(</span>11.504683, -0.124552<span class="o">)</span>
Layer SRS WKT:
GEOGCS<span class="o">[</span><span class="s2">&quot;GCS_WGS_1984&quot;</span>,
    DATUM<span class="o">[</span><span class="s2">&quot;WGS_1984&quot;</span>,
        SPHEROID<span class="o">[</span><span class="s2">&quot;WGS_84&quot;</span>,6378137,298.257223563<span class="o">]]</span>,
    PRIMEM<span class="o">[</span><span class="s2">&quot;Greenwich&quot;</span>,0<span class="o">]</span>,
    UNIT<span class="o">[</span><span class="s2">&quot;Degree&quot;</span>,0.017453292519943295<span class="o">]]</span>
fid: String <span class="o">(</span>80.0<span class="o">)</span>
Name: String <span class="o">(</span>7.0<span class="o">)</span>
</pre></div>

    </div><!-- /.entry-content -->
    

  </article>
</section>

        <section id="extras" class="body">
        
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://getpelican.com/">Pelican</a>, which takes great advantage of <a href="http://python.org">Python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-25702318-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



</body>
</html>