<!DOCTYPE html>
<html lang="en">
<head>
        <title>jgomezdans - data assimilation</title>
        <meta charset="utf-8" />
        <link rel="stylesheet" href=".././theme/css/main.css" type="text/css" />
        <link href=".././feeds/all.atom.xml" type="application/atom+xml" rel="alternate" title="jgomezdans ATOM Feed" />
        

        <!--[if IE]>
                <script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"></script><![endif]-->

        <!--[if lte IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie.css"/>
                <script src=".././js/IE8.js" type="text/javascript"></script><![endif]-->

        <!--[if lt IE 7]>
                <link rel="stylesheet" type="text/css" media="all" href=".././css/ie6.css"/><![endif]-->
	<!-- Using MathJax, with the delimiters $ -->
	<!-- Conflict with pygments for the .mo and .mi -->
	<script type="text/x-mathjax-config">
	  MathJax.Hub.Config({
	  "HTML-CSS": {
	  styles: {
	  ".MathJax .mo, .MathJax .mi": {color: "black ! important"}}
	  },
	  tex2jax: {inlineMath: [['$','$'], ['\\\\(','\\\\)']],processEscapes: true}
	  });
	</script>
	
	<script type="text/javascript" src="http://cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS_HTML"></script>
	
</head>

<body id="index" class="home">

<a href="http://github.com/jgomezdans">

<img style="position: absolute; top: 0; right: 0; border: 0;" src="http://s3.amazonaws.com/github/ribbons/forkme_right_red_aa0000.png" alt="Fork me on GitHub" />

</a>

        <header id="banner" class="body">
                <h1><a href="../.">jgomezdans </a></h1>
                <nav><ul>
                
                
                
                
                
                    <li ><a href=".././category/Blog.html">Blog</a></li>
                
                </ul></nav>
        </header><!-- /#banner -->
                

            

        
        
            <aside id="featured" class="body">
                <article>
                    <h1 class="entry-title"><a href=".././eoldas-out-in-the-wild.html">EOLDAS out in the wild!</a></h1> 
                    <footer class="post-info">
        <abbr class="published" title="2012-07-18T15:00:00">
                Wed 18 July 2012
        </abbr>

        
        <address class="vcard author">
                By <a class="url fn" href=".././author/J Gómez-Dans.html">J Gómez-Dans</a>
        </address>
        
<p>In <a href=".././category/Blog.html">Blog</a>. </p>
<p>tags: <a href=".././tag/remote sensing.html">remote sensing</a><a href=".././tag/data assimilation.html">data assimilation</a></p>


</footer><!-- /.post-info --><p>After quite some time, we have released the <a class="reference external" href="http://jgomezdans.github.com/eoldas_release">EOLDAS software</a>.
The <a class="reference external" href="http://jgomezdans.github.com/eoldas_release">EOLDAS software</a>
is a prototype <a class="reference external" href="http://en.wikipedia.org/wiki/Data_assimilation">data assimilation</a>
framework for the land surface, although it is quite generic, and can
be used for typical variational problems, with a weak or a strong
constraint. In essence, data assimilation is the probabilistically
sound way of merging prior information about processes (such as
mechanistic models, <em>à la DGVM</em>, but also prior information about
things, maybe derived from previous studies) and observations (which
will have noise). It's a solution to Bayes' Theorem, and what's really
important is that you also get full uncertainties.</p>
<p>The way EOLDAS works is by specifying a cost function that will be
minimised using a gradient descent method. This naturally requires
information on the derivatives of such cost function. If you have an
adjoint code, then you can use that, and that's what we do. But you
need adjoints for your dynamic model terms, observation operators, etc.
These codes are often complicated and getting the adjoints will be even
more complicated. You could use numerical approximations to the derivatives,
but that's a bit clunky, and requires running often computationally
expensive models many times.</p>
<p>The main assumption in EOLDAS is that the cost function is Gaussian.
We can build up quite complex cost functions by adding individual terms.
Typically, these terms could be</p>
<ol class="arabic simple">
<li>A observation mismatch term, $J_{obs}$.</li>
<li>A prior term, $J_{prior}$.</li>
<li>A dynamic model mismatch term, $J_{model}$.</li>
</ol>
<p>For example, $J_{obs}$ can be written under the assumption that the
state is $\mathbf{x}$, the observations are $\mathbf{y}_{obs}$,
the observation operator (that transforms the state into observations)
is $H$, and the observational uncertainty covariance matrix is given by
$\mathbf{C}_{obs}$. We could include <em>structural error</em> (if we know that
the model is imperfect) with a covariance matrix $\mathbf{C}_{H}$, but
will usually ignore this term. $J_{obs}$ is then
\[
J_{obs} = (1/2) (\mathbf{y_{obs}} - H(\mathbf{x}))^{T} (\mathbf{C_{obs}}^{-1}+\mathbf{C_{H}}^{-1}) (\mathbf{y_{obs}} -H(\mathbf{x} )),
\]</p>
<p>The prior term is just the mismatch between the states and the prior
value, moderated by how certain/ignorant we are about this prior
value:
\[
J_{prior} = (1/2) (\mathbf{x} - H(\mathbf{x}_{prior}))^{T} \mathbf{C}_{prior}^{-1} (\mathbf{x} - H(\mathbf{x}_{prior})),
\]</p>
<p>The dynamic model term is similarly calculated as the mismatch between
a prediction of the state from a previous value and the inferred state.
A simple linear model $\mathbf{A}\mathbf{x} + \mathbf{B}$ can be
used. The easiest useful model is a differential operator model, which
implies that the first (second...) derivative of the state is minimised
resulting in a penalisaiton to unsmooth state trajectories. The
first order differential operator is
\[
\mathbf{\Delta} =
\begin{pmatrix}
1      &amp; -1     &amp;  0     &amp; \cdots &amp; 0\\
0      &amp; 1      &amp; -1     &amp; \cdots &amp; 0\\
\vdots &amp; \vdots &amp; \vdots &amp; \ddots &amp; 0\\
0      &amp; 0      &amp; 0      &amp; \cdots &amp; -1\\
\end{pmatrix}
\]
and the associated cost function is $J_{model}$. We may want to have
a diagonal $\mathbf{C}_{smooth}$ &quot;model uncertainty&quot; matrix, which is
in fact the identity, and we can control its magnitude by multiplying it
by some $\gamma$$ scalar. This terms basically scales how much we allow
the inferred state to depart from the model, and is in essence, the weak
constraint. A strong constraint system will make the inferred solution
lie in the space of the model:
\[
J_{model} = (1/2)  \gamma^{2} (\mathbf{\Delta x})^{T}\mathbf{C}_{smooth}^{-1}(\mathbf{\Delta x)}.
\]</p>
<p>So the total cost function is $J$:
\[
J = J_{obs} + J_{prior} + J_{model}
\]
and this function is minimised. Once the minimum is reached, the uncertainty
can be calculated from the inverse of the Hessian matrix, under the assumption
that the posterior distribution is not too far off from Gaussian.</p>
<p>So what do you get out of this? Well, for one, you can estimate many
parameters. Using typical optical remote sensing data, you can estimate
6 or 7 parameters for sensors like MODIS. So not only do you get LAI,
but you can also get a gauge on chlorophyll concentration, etc. Here's
a reasonable example from a wheat field in Germany, where we are solving
for 7 parameters:</p>
<dl class="docutils">
<dt>LAI</dt>
<dd>Leaf Area Index</dd>
<dt>CAB</dt>
<dd>Chorophyll a+b concentration</dd>
<dt>SEN</dt>
<dd>Leaf senescent matter</dd>
<dt>EWT</dt>
<dd>Leaf equivalent water thickness</dd>
<dt>DM</dt>
<dd>Dry Matter</dd>
<dt>N</dt>
<dd>Leaf Layers</dd>
<dt>S1</dt>
<dd>First component of soil reflenctance model</dd>
</dl>
<div class="figure">
<img alt="./static/images/results.png" src="../static/static/images/results.png" style="width: 90%;" />
<p class="caption">EOLDAS processing result.</p>
</div>

                </article>
                
                    
<p class="paginator">
    
    Page 1 / 1
    
</p>

                
            </aside><!-- /#featured -->
            
        
        
        

    


        <section id="extras" class="body">
        
                <div class="blogroll">
                        <h2>blogroll</h2>
                        <ul>
                        
                            <li><a href="http://docs.notmyidea.org/alexis/pelican/">Pelican</a></li>
                        
                            <li><a href="http://python.org">Python.org</a></li>
                        
                            <li><a href="http://jinja.pocoo.org">Jinja2</a></li>
                        
                            <li><a href="#">You can modify those links in your config file</a></li>
                        
                        </ul>
                </div><!-- /.blogroll -->
        
        
                <div class="social">
                        <h2>social</h2>
                        <ul>
                            <li><a href=".././feeds/all.atom.xml" rel="alternate">atom feed</a></li>
                            

                        
                            <li><a href="#">You can add links in your config file</a></li>
                        
                        </ul>
                </div><!-- /.social -->
        
        </section><!-- /#extras -->

        <footer id="contentinfo" class="body">
                <address id="about" class="vcard body">
                Proudly powered by <a href="http://alexis.notmyidea.org/pelican/">pelican</a>, which takes great advantages of <a href="http://python.org">python</a>.
                </address><!-- /#about -->

                <p>The theme is by <a href="http://coding.smashingmagazine.com/2009/08/04/designing-a-html-5-layout-from-scratch/">Smashing Magazine</a>, thanks!</p>
        </footer><!-- /#contentinfo -->


    <script type="text/javascript">
    var gaJsHost = (("https:" == document.location.protocol) ? "https://ssl." : "http://www.");
    document.write(unescape("%3Cscript src='" + gaJsHost + "google-analytics.com/ga.js' type='text/javascript'%3E%3C/script%3E"));
    </script>
    <script type="text/javascript">
    try {
        var pageTracker = _gat._getTracker("UA-25702318-1");
    pageTracker._trackPageview();
    } catch(err) {}</script>



</body>
</html>